import{r as i,j as e,L as k,S as g}from"./app-Dg_XfmtV.js";import{A as L}from"./app-layout-8u2Zrk1L.js";import{c as v,B as f}from"./app-logo-icon-wWDaImND.js";import{I as C}from"./input-oG3BPt4U.js";import{L as y}from"./loader-circle-Bn73Uf9t.js";import"./index-B8BmQMzw.js";import"./index-CHep7cZB.js";import"./i18n-BydKRAa4.js";import"./vadiher-CxvhmT4V.js";const R=({className:c,orientation:d="horizontal",children:x})=>{const r=i.Children.count(x),n=d==="horizontal",o=d==="vertical";return e.jsx("div",{className:v("flex",{"flex-col":o,"w-fit":o},c),children:i.Children.map(x,(s,h)=>{const l=h===0,u=h===r-1;return i.cloneElement(s,{className:v({"rounded-s-none":n&&!l,"rounded-e-none":n&&!u,"border-s-0":n&&!l,"rounded-t-none":o&&!l,"rounded-b-none":o&&!u,"border-t-0":o&&!l},s.props.className)})})})},F=[{title:"Ticket",href:"/inventarios/ticket"}];function z({refere:c}){const[d,x]=i.useState(null),[r,n]=i.useState(!1),[o,s]=i.useState(null),h=()=>{if(!d)return alert("Selecciona un archivo Excel primero");const t=new FormData;t.append("file",d),g.post("/inventarios/ticket/import",t)},l=()=>{window.location.href="/inventarios/ticket/export"},u=async()=>{var t;try{n(!0),s("Iniciando generación del PDF...");const a=(t=document.querySelector('meta[name="csrf-token"]'))==null?void 0:t.content;fetch("/inventarios/ticket/pdf/process",{method:"POST",headers:{"X-CSRF-TOKEN":a??"",Accept:"application/json"}}).catch(b=>{console.error("Error al iniciar el proceso:",b)});const N=setInterval(async()=>{const m=await(await fetch("/inventarios/ticket/pdf/progress")).json();if(s(`Generando tickets... ${m.processed} de ${m.total}`),m.processed>=m.total&&m.total>0){clearInterval(N),s("Finalizando, descargando PDF...");const w=await(await fetch("/inventarios/ticket/pdf/download")).blob(),j=window.URL.createObjectURL(w),p=document.createElement("a");p.href=j,p.download="tickets_completo.pdf",document.body.appendChild(p),p.click(),p.remove(),window.URL.revokeObjectURL(j),s("✅ Tickets generados correctamente."),n(!1)}},1e3)}catch(a){console.error("Error al generar el PDF",a),s("❌ Ocurrió un error al generar el PDF."),n(!1)}};return e.jsxs(L,{breadcrumbs:F,children:[e.jsx(k,{title:"Ticket"}),e.jsxs("div",{className:"p-6 space-y-6 bg-white rounded-xl shadow-md",children:[e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 items-center",children:[e.jsx(C,{id:"file",type:"file",name:"file",accept:".xlsx, .xls",onChange:t=>{var a;return x(((a=t.target.files)==null?void 0:a[0])||null)},className:"w-full"}),e.jsxs(R,{children:[e.jsx(f,{onClick:l,variant:"outline",disabled:r,children:"Generar archivo"}),e.jsx(f,{onClick:h,variant:"green",disabled:r,children:"Importar"}),e.jsxs(f,{onClick:u,variant:"cyan",disabled:r,children:[r&&e.jsx(y,{className:"animate-spin h-4 w-4 mr-2"}),r?"Generando tickets...":"Generar Tickets"]})]})]}),r?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:"text-center",children:[e.jsx(y,{className:"animate-spin h-6 w-6 text-cyan-700 mx-auto mb-2"}),e.jsx("p",{className:"text-blue-700 font-medium",children:o})]})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"overflow-x-auto",children:c.data.length>0?e.jsxs("table",{className:"min-w-full border border-gray-300 text-sm",children:[e.jsx("thead",{className:"bg-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 border",children:"Referencia"}),e.jsx("th",{className:"px-4 py-2 border",children:"Nombre"}),e.jsx("th",{className:"px-4 py-2 border",children:"Código"}),e.jsx("th",{className:"px-4 py-2 border",children:"Und. Med."})]})}),e.jsx("tbody",{children:c.data.map(t=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-2 border",children:t.ref_refere}),e.jsx("td",{className:"px-4 py-2 border",children:t.ref_nombre}),e.jsx("td",{className:"px-4 py-2 border",children:t.ref_codigo}),e.jsx("td",{className:"px-4 py-2 border",children:t.ref_undmed})]},t.id))})]}):e.jsx("p",{className:"text-sm text-gray-600 text-center",children:"No hay referencias registradas."})}),c.links.length>3&&e.jsx("div",{className:"flex flex-wrap items-center gap-2",children:c.links.map((t,a)=>e.jsx("button",{disabled:!t.url,onClick:()=>t.url&&g.visit(t.url),className:`px-3 py-1 text-sm rounded border transition ${t.active?"bg-blue-600 text-white":"bg-white hover:bg-gray-100 text-gray-700"}`,dangerouslySetInnerHTML:{__html:t.label}},a))})]})]})]})}export{z as default};
