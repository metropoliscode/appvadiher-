import{r as c,j as e,L as y,S as b}from"./app-BezMx6Yg.js";import{A as N}from"./app-layout-CcYk1XwA.js";import{c as j,B as u}from"./app-logo-icon-tjY2ApU_.js";import{I as v}from"./input-DeL_IZQ0.js";import{L as g}from"./loader-circle-D_ijU7Tc.js";import"./index-BVbG2WsP.js";import"./index-Bv9mkpsH.js";import"./i18n-BydKRAa4.js";import"./vadiher-CxvhmT4V.js";const w=({className:t,orientation:d="horizontal",children:p})=>{const s=c.Children.count(p),a=d==="horizontal",n=d==="vertical";return e.jsx("div",{className:j("flex",{"flex-col":n,"w-fit":n},t),children:c.Children.map(p,(o,x)=>{const l=x===0,h=x===s-1;return c.cloneElement(o,{className:j({"rounded-s-none":a&&!l,"rounded-e-none":a&&!h,"border-s-0":a&&!l,"rounded-t-none":n&&!l,"rounded-b-none":n&&!h,"border-t-0":n&&!l},o.props.className)})})})},k=[{title:"Ticket",href:"/inventarios/ticket"}];function T({refere:t}){const[d,p]=c.useState(null),[s,a]=c.useState(!1),[n,o]=c.useState(null),x=()=>{if(!d)return alert("Selecciona un archivo Excel primero");const r=new FormData;r.append("file",d),b.post("/inventarios/ticket/import",r)},l=()=>{window.location.href="/inventarios/ticket/export"},h=async()=>{try{a(!0),o("Generando todos los tickets, por favor espera...");const i=await(await fetch("/inventarios/ticket/pdf")).blob(),f=window.URL.createObjectURL(i),m=document.createElement("a");m.href=f,m.download="tickets_completo.pdf",document.body.appendChild(m),m.click(),m.remove(),window.URL.revokeObjectURL(f),o("✅ Tickets generados correctamente.")}catch(r){console.error("Error al generar el PDF",r),o("❌ Ocurrió un error al generar el PDF.")}finally{a(!1)}};return e.jsxs(N,{breadcrumbs:k,children:[e.jsx(y,{title:"Ticket"}),e.jsxs("div",{className:"p-6 space-y-6 bg-white rounded-xl shadow-md",children:[e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 items-center",children:[e.jsx(v,{id:"file",type:"file",name:"file",accept:".xlsx, .xls",onChange:r=>{var i;return p(((i=r.target.files)==null?void 0:i[0])||null)},className:"w-full"}),e.jsxs(w,{children:[e.jsx(u,{onClick:l,variant:"outline",disabled:s,children:"Generar archivo"}),e.jsx(u,{onClick:x,variant:"green",disabled:s,children:"Importar"}),e.jsxs(u,{onClick:h,variant:"cyan",disabled:s,children:[s&&e.jsx(g,{className:"animate-spin h-4 w-4 mr-2"}),s?"Generando tickets...":"Generar Tickets"]})]})]}),s?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsxs("div",{className:"flex items-center gap-2 text-blue-600 text-sm font-medium",children:[e.jsx(g,{className:"animate-spin w-5 h-5"}),"Generando PDF, por favor espera..."]})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"overflow-x-auto",children:t.data.length>0?e.jsxs("table",{className:"min-w-full border border-gray-300 text-sm",children:[e.jsx("thead",{className:"bg-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 border",children:"Referencia"}),e.jsx("th",{className:"px-4 py-2 border",children:"Nombre"}),e.jsx("th",{className:"px-4 py-2 border",children:"Código"}),e.jsx("th",{className:"px-4 py-2 border",children:"Und. Med."})]})}),e.jsx("tbody",{children:t.data.map(r=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-2 border",children:r.ref_refere}),e.jsx("td",{className:"px-4 py-2 border",children:r.ref_nombre}),e.jsx("td",{className:"px-4 py-2 border",children:r.ref_codigo}),e.jsx("td",{className:"px-4 py-2 border",children:r.ref_undmed})]},r.id))})]}):e.jsx("p",{className:"text-sm text-gray-600 text-center",children:"No hay referencias registradas."})}),t.links.length>3&&e.jsx("div",{className:"flex flex-wrap items-center gap-2",children:t.links.map((r,i)=>e.jsx("button",{disabled:!r.url,onClick:()=>r.url&&b.visit(r.url),className:`px-3 py-1 text-sm rounded border transition ${r.active?"bg-blue-600 text-white":"bg-white hover:bg-gray-100 text-gray-700"}`,dangerouslySetInnerHTML:{__html:r.label}},i))})]})]})]})}export{T as default};
